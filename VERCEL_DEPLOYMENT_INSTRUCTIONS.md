# ðŸš€ Vercel Deployment Instructions

## âœ… **Fixed Issues**
- Removed environment variable references from `vercel.json`
- Environment variables must be set in Vercel Dashboard, not in config file
- Fixed API rewrites to use correct environment variable names
- **NEW**: Removed `pnpm-lock.yaml` to prevent package manager conflicts
- **NEW**: Added Node.js version specification (18+) for compatibility
- **NEW**: Fixed package name to follow npm conventions
- **LATEST**: Fixed Next.js security vulnerability (CVE-2025-66478) by upgrading to 15.4.8
- **NEWEST**: Fixed Edge Function middleware deployment errors by simplifying middleware
- **NEWEST**: Added security headers and SEO files to help with Vercel security checkpoint

## ðŸ“‹ **Step-by-Step Vercel Deployment**

### **1. Connect Repository to Vercel**
1. Go to [Vercel Dashboard](https://vercel.com/dashboard)
2. Click "New Project"
3. Import your GitHub repository
4. **Important**: Set Root Directory to `frontend`
5. Framework Preset: Next.js (auto-detected)

### **2. Configure Environment Variables**
In Vercel Dashboard â†’ Project Settings â†’ Environment Variables, add these:

#### **Required Environment Variables:**
```bash
# NextAuth Configuration
NEXTAUTH_URL=https://your-app-name.vercel.app
NEXTAUTH_SECRET=wATIAUyLXyDOmiwdqCBwvVnNV6NYlRwe1aSVWyw+Tg0=

# GitHub OAuth App (create at: https://github.com/settings/applications/new)
GITHUB_CLIENT_ID=your_github_oauth_client_id
GITHUB_CLIENT_SECRET=your_github_oauth_client_secret

# WalletConnect (get from: https://cloud.walletconnect.com/)
NEXT_PUBLIC_WALLETCONNECT_PROJECT_ID=your_walletconnect_project_id

# Smart Contract (Sepolia Testnet)
NEXT_PUBLIC_CONTRACT_ADDRESS=0xC381B1dd37B82810356EdD61Cb584e3228457aC7

# Backend API URL (update after Render deployment)
NEXT_PUBLIC_API_URL=https://your-backend-url.onrender.com

# Self.xyz Integration (Optional)
NEXT_PUBLIC_SELF_APP_NAME=Nexus
NEXT_PUBLIC_SELF_SCOPE=
NEXT_PUBLIC_SELF_ENDPOINT=
```

### **3. GitHub OAuth App Setup**
1. Go to: https://github.com/settings/applications/new
2. **Application name**: `Nexus Platform`
3. **Homepage URL**: `https://your-app-name.vercel.app`
4. **Authorization callback URL**: `https://your-app-name.vercel.app/api/auth/callback/github`
5. Copy the Client ID and Client Secret to Vercel environment variables

### **4. Deploy**
1. Click "Deploy" in Vercel
2. Wait for build to complete
3. Your app will be available at `https://your-app-name.vercel.app`

### **5. Update URLs After Deployment**
After both frontend and backend are deployed:
1. Update `NEXTAUTH_URL` in Vercel with your actual domain
2. Update `NEXT_PUBLIC_API_URL` in Vercel with your Render backend URL
3. Update GitHub OAuth app URLs with production domains

## ðŸ”§ **Troubleshooting**

### **Common Issues:**

#### **1. Package Manager Conflicts**
**Error**: `Detected pnpm-lock.yaml which may be generated by pnpm@9.x or pnpm@10.x`
**Solution**: 
- Removed `pnpm-lock.yaml` file
- Added `.vercelignore` to prevent conflicts
- Vercel will now use npm as specified in `vercel.json`

#### **2. Next.js Security Vulnerability**
**Error**: `Vulnerable version of Next.js detected, please update immediately. Learn More: https://vercel.link/CVE-2025-66478`
**Solution**:
- Updated Next.js from 15.5.4 to 15.4.8 (patched version)
- Avoided Next.js 16.x due to breaking changes with dependencies
- Build now passes without security warnings

#### **3. Node.js Version Conflicts**
**Error**: `Unsupported engine { package: '@selfxyz/common@0.0.9', required: { node: '>=22 <23' }`
**Solution**:
- Added `engines` field in `package.json` specifying Node 18+
- Added `.nvmrc` file for explicit version control
- Vercel will use compatible Node.js version

#### **4. Edge Function Middleware Errors**
**Error**: `Can't deploy Edge Function middleware` or `Unexpected internal middleware failure`
**Solution**:
- Simplified middleware to avoid NextAuth Edge Runtime issues
- Replaced complex auth middleware with simple pass-through
- Reduced middleware bundle size from 90.7 kB to 38.3 kB

#### **5. Vercel Security Checkpoint**
**Error**: `Vercel Security Checkpoint` page with browser verification
**Solution**:
- Added security headers (X-Frame-Options, X-Content-Type-Options)
- Added robots.txt and sitemap.xml for better SEO signals
- Simplified middleware to reduce suspicious patterns
- Wait a few minutes and try redeploying

#### **6. Other Common Issues**
1. **Build Fails**: Check that Root Directory is set to `frontend`
2. **Environment Variables**: Set them in Vercel Dashboard, not in code
3. **OAuth Errors**: Ensure callback URLs match exactly
4. **API Errors**: Verify backend URL is correct and accessible

### **Build Configuration:**
- âœ… Framework: Next.js
- âœ… Root Directory: `frontend`
- âœ… Build Command: `npm run build` (auto-detected)
- âœ… Install Command: `npm install --legacy-peer-deps`

## ðŸŽ‰ **Success!**
Your Nexus platform should now be deployed successfully on Vercel with proper environment variable configuration!
